{"version":3,"file":"BlueMarble.user.js","names":["_Overlay_instances","createElement_fn","WeakSet","tag","properties","additionalProperties","element","document","createElement","this","overlay","currentParent","appendChild","parentStack","push","property","value","Object","entries","Utils","escapeHTML","text","div","textContent","innerHTML","name","GM_info","script","toString","version","fn","documentElement","remove","inject","originalFetch","window","fetch","async","args","response","apply","cloned","clone","headers","get","includes","endpointName","Request","url","console","log","json","then","jsonData","postMessage","source","endpoint","catch","err","error","cssOverlay","GM_getResourceText","GM_addStyle","stylesheetLink","href","rel","as","onload","head","constructor","observerBody","observerBodyTarget","targetDisplayCoords","createObserverBody","target","MutationObserver","mutations","mutation","node","addedNodes","HTMLElement","matches","getObserverBody","observe","observer","watchChildList","watchSubtree","childList","subtree","apiHandler","outputStatusId","setApiHandler","buildElement","length","pop","buildOverlay","parent","addDiv","callback","__privateMethod","call","addP","addImg","addHeader","level","addHr","addBr","addCheckbox","label","checkbox","type","insertBefore","firstChild","addButton","addButtonHelp","tooltip","className","onclick","updateInnerHTML","addInput","addInputFile","container","input","style","button","addEventListener","click","maxWidth","offsetWidth","files","addTextarea","id","html","doSafe","getElementById","replace","HTMLInputElement","handleDrag","moveMe","iMoveThings","offsetX","isDragging","offsetY","querySelector","event","clientX","getBoundingClientRect","left","clientY","top","body","userSelect","classList","add","touch","touches","passive","right","preventDefault","handleDisplayError","consoleError","coordsHandler","serverTPtoDisplayTP","tile","pixel","parseInt","disableAll","coordsTilePixel","spontaneousResponseListener","data","dataJSON","endpointText","split","filter","s","isNaN","Number","nextLevelPixels","Math","ceil","pow","floor","clog","droplets","Intl","NumberFormat","format","coordsTile","payloadExtractor","URLSearchParams","coordsPixel","displayTP","spanElements","querySelectorAll","trim","displayCoords","parentNode","insertAdjacentElement","toLowerCase","alt","src","checked","title","instance","coords","placeholder","min","max","step","readOnly"],"sources":["../src/overlay.js","../src/observers.js","../src/utils.js","../src/main.js","../src/coordsHandler.js","../src/apiHandler.js"],"sourcesContent":["/** The overlay builder for the Blue Marble script.\r\n * @description This class handles the overlay UI for the Blue Marble script.\r\n * @since 0.0.2\r\n * @example\r\n * const overlay = new Overlay();\r\n * overlay.addDiv('overlay')\r\n *   .addHeader(1, {'textContent': 'Your Overlay'}).buildElement()\r\n *   .addP({'textContent': 'This is your overlay. It is versatile.'}).buildElement()\r\n *   .addHr().buildElement()\r\n * .buildOverlay(document.body);\r\n * // Output:\r\n * // (Assume <body> already exists in the webpage)\r\n * <body>\r\n *   <div id=\"overlay\">\r\n *     <h1>Your Overlay</h1>\r\n *     <p>This is your overlay. It is versatile.</p>\r\n *   </div>\r\n * </body>\r\n*/\r\nexport default class Overlay {\r\n\r\n  /** Constructor for the Overlay class.\r\n   * @param {string} name - The name of the userscript\r\n   * @param {string} version - The version of the userscript\r\n   * @since 0.0.2\r\n   * @see {@link Overlay}\r\n   */\r\n  constructor(name, version) {\r\n    this.name = name; // Name of userscript\r\n    this.version = version; // Version of userscript\r\n\r\n    this.apiHandler = null; // The API handler instance. Later populated when setApiHandler is called\r\n    \r\n    this.outputStatusId = 'bm-output-status'; // ID for status element\r\n\r\n    this.overlay = null; // The overlay root DOM HTMLElement\r\n    this.currentParent = null; // The current parent HTMLElement in the overlay\r\n    this.parentStack = []; // Tracks the parent elements BEFORE the currentParent so we can nest elements\r\n  }\r\n\r\n  /** Populates the apiHandler variable with the apiHandler class.\r\n   * @param {apiHandler} apiHandler - The apiHandler class instance\r\n   * @since 0.41.4\r\n   */\r\n  setApiHandler(apiHandler) {this.apiHandler = apiHandler;}\r\n\r\n  /** Creates an element.\r\n   * For **internal use** of the {@link Overlay} class.\r\n   * @param {string} tag - The tag name as a string.\r\n   * @param {Object.<string, any>} [properties={}] - The DOM properties of the element.\r\n   * @returns {HTMLElement} HTML Element\r\n   * @since 0.43.2\r\n   */\r\n  #createElement(tag, properties = {}, additionalProperties={}) {\r\n\r\n    const element = document.createElement(tag); // Creates the element\r\n\r\n    // If this is the first element made...\r\n    if (!this.overlay) {\r\n      this.overlay = element; // Declare it the highest overlay element\r\n      this.currentParent = element;\r\n    } else {\r\n      this.currentParent.appendChild(element); // ...else delcare it the child of the last element\r\n      this.parentStack.push(this.currentParent);\r\n      this.currentParent = element;\r\n    }\r\n\r\n    // For every passed in property (shared by all like-elements), apply the it to the element\r\n    for (const [property, value] of Object.entries(properties)) {\r\n      element[property] = value;\r\n    }\r\n\r\n    // For every passed in additional property, apply the it to the element\r\n    for (const [property, value] of Object.entries(additionalProperties)) {\r\n      element[property] = value;\r\n    }\r\n    \r\n    return element;\r\n  }\r\n\r\n  /** Finishes building an element.\r\n   * Call this after you are finished adding children.\r\n   * If the element will have no children, call it anyways.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.2\r\n   * @example\r\n   * overlay\r\n   *   .addDiv()\r\n   *     .addHeader(1).buildElement() // Breaks out of the <h1>\r\n   *     .addP().buildElement() // Breaks out of the <p>\r\n   *   .buildElement() // Breaks out of the <div>\r\n   *   .addHr() // Since there are no more elements, calling buildElement() is optional\r\n   * .buildOverlay(document.body);\r\n   */\r\n  buildElement() {\r\n    if (this.parentStack.length > 0) {\r\n      this.currentParent = this.parentStack.pop();\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /** Finishes building the overlay and displays it.\r\n   * Call this when you are done chaining methods.\r\n   * @param {HTMLElement} parent - The parent HTMLElement this overlay should be appended to as a child.\r\n   * @since 0.43.2\r\n   * @example\r\n   * overlay\r\n   *   .addDiv()\r\n   *     .addP().buildElement()\r\n   *   .buildElement()\r\n   * .buildOverlay(document.body); // Adds DOM structure to document body\r\n   * // <div><p></p></div>\r\n   */\r\n  buildOverlay(parent) {\r\n    parent.appendChild(this.overlay);\r\n\r\n    // Resets the class-bound variables of this class instance back to default so overlay can be build again later\r\n    this.overlay = null;\r\n    this.currentParent = null;\r\n    this.parentStack = [];\r\n  }\r\n\r\n  /** Adds a `<div>` to the overlay.\r\n   * This `<div>` element will have properties shared between all `<div>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<div>` that are NOT shared between all overlay `<div>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLDivElement):void} [callback=()=>{}] - Additional JS modification to the `<div>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.2\r\n   * @example\r\n   * // Assume all <div> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addDiv({'id': 'foo'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <div id=\"foo\" class=\"bar\"></div>\r\n   * </body>\r\n   */\r\n  addDiv(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <div> DOM properties\r\n\r\n    const div = this.#createElement('div', properties, additionalProperties); // Creates the <div> element\r\n    callback(this, div); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<p>` to the overlay.\r\n   * This `<p>` element will have properties shared between all `<p>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<p>` that are NOT shared between all overlay `<p>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLParagraphElement):void} [callback=()=>{}] - Additional JS modification to the `<p>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.2\r\n   * @example\r\n   * // Assume all <p> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addP({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <p id=\"foo\" class=\"bar\">Foobar.</p>\r\n   * </body>\r\n   */\r\n  addP(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <p> DOM properties\r\n\r\n    const p = this.#createElement('p', properties, additionalProperties); // Creates the <p> element\r\n    callback(this, p); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<img>` to the overlay.\r\n   * This `<img>` element will have properties shared between all `<img>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<img>` that are NOT shared between all overlay `<img>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLImageElement):void} [callback=()=>{}] - Additional JS modification to the `<img>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.2\r\n   * @example\r\n   * // Assume all <img> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addimg({'id': 'foo', 'src': './img.png'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <img id=\"foo\" src=\"./img.png\" class=\"bar\">\r\n   * </body>\r\n   */\r\n  addImg(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <img> DOM properties\r\n\r\n    const img = this.#createElement('img', properties, additionalProperties); // Creates the <img> element\r\n    callback(this, img); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a header to the overlay.\r\n   * This header element will have properties shared between all header elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {number} level - The header level. Must be between 1 and 6 (inclusive)\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the header that are NOT shared between all overlay header elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLHeadingElement):void} [callback=()=>{}] - Additional JS modification to the header.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.7\r\n   * @example\r\n   * // Assume all header elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addHeader(6, {'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <h6 id=\"foo\" class=\"bar\">Foobar.</h6>\r\n   * </body>\r\n   */\r\n  addHeader(level, additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared header DOM properties\r\n\r\n    const header = this.#createElement('h' + level, properties, additionalProperties); // Creates the header element\r\n    callback(this, header); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<hr>` to the overlay.\r\n   * This `<hr>` element will have properties shared between all `<hr>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<hr>` that are NOT shared between all overlay `<hr>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLHRElement):void} [callback=()=>{}] - Additional JS modification to the `<hr>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.7\r\n   * @example\r\n   * // Assume all <hr> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addhr({'id': 'foo'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <hr id=\"foo\" class=\"bar\">\r\n   * </body>\r\n   */\r\n  addHr(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <hr> DOM properties\r\n\r\n    const hr = this.#createElement('hr', properties, additionalProperties); // Creates the <hr> element\r\n    callback(this, hr); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<br>` to the overlay.\r\n   * This `<br>` element will have properties shared between all `<br>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<br>` that are NOT shared between all overlay `<br>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLBRElement):void} [callback=()=>{}] - Additional JS modification to the `<br>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.11\r\n   * @example\r\n   * // Assume all <br> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addbr({'id': 'foo'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <br id=\"foo\" class=\"bar\">\r\n   * </body>\r\n   */\r\n  addBr(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <br> DOM properties\r\n\r\n    const br = this.#createElement('br', properties, additionalProperties); // Creates the <br> element\r\n    callback(this, br); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a checkbox to the overlay.\r\n   * This checkbox element will have properties shared between all checkbox elements in the overlay.\r\n   * You can override the shared properties by using a callback. Note: the checkbox element is inside a label element.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the checkbox that are NOT shared between all overlay checkbox elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLLabelElement, HTMLInputElement):void} [callback=()=>{}] - Additional JS modification to the checkbox.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.10\r\n   * @example\r\n   * // Assume all checkbox elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addCheckbox({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <label>\r\n   *     <input type=\"checkbox\" id=\"foo\" class=\"bar\">\r\n   *     \"Foobar.\"\r\n   *   </label>\r\n   * </body>\r\n   */\r\n  addCheckbox(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {'type': 'checkbox'}; // Shared checkbox DOM properties\r\n\r\n    const label = this.#createElement('label', {'textContent': additionalProperties['textContent'] ?? ''}); // Creates the label element\r\n    delete additionalProperties['textContent']; // Deletes 'textContent' DOM property before adding the properties to the checkbox\r\n    const checkbox = this.#createElement('input', properties, additionalProperties); // Creates the checkbox element\r\n    label.insertBefore(checkbox, label.firstChild); // Makes the checkbox the first child of the label (before the text content)\r\n    this.buildElement(); // Signifies that we are done adding children to the checkbox\r\n    callback(this, label, checkbox); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n  \r\n  /** Adds a `<button>` to the overlay.\r\n   * This `<button>` element will have properties shared between all `<button>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<button>` that are NOT shared between all overlay `<button>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLButtonElement):void} [callback=()=>{}] - Additional JS modification to the `<button>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.12\r\n   * @example\r\n   * // Assume all <button> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addButton({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <button id=\"foo\" class=\"bar\">Foobar.</button>\r\n   * </body>\r\n   */\r\n  addButton(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <button> DOM properties\r\n\r\n    const button = this.#createElement('button', properties, additionalProperties); // Creates the <button> element\r\n    callback(this, button); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a help button to the overlay. It will have a \"?\" icon unless overridden in callback.\r\n   * On click, the button will attempt to output the title to the output element (ID defined in Overlay constructor).\r\n   * This `<button>` element will have properties shared between all `<button>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<button>` that are NOT shared between all overlay `<button>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLButtonElement):void} [callback=()=>{}] - Additional JS modification to the `<button>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.12\r\n   * @example\r\n   * // Assume all help button elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addButtonHelp({'id': 'foo', 'title': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <button id=\"foo\" class=\"bar\" title=\"Help: Foobar.\">?</button>\r\n   * </body>\r\n   * @example\r\n   * // Assume all help button elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addButtonHelp({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <button id=\"foo\" class=\"bar\" title=\"Help: Foobar.\">?</button>\r\n   * </body>\r\n   */\r\n  addButtonHelp(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const tooltip = additionalProperties['title'] ?? additionalProperties['textContent'] ?? 'Help: No info'; // Retrieves the tooltip\r\n\r\n    // Makes sure the tooltip is stored in the title property\r\n    delete additionalProperties['textContent'];\r\n    additionalProperties['title'] = `Help: ${tooltip}`;\r\n\r\n    // Shared help button DOM properties\r\n    const properties = {\r\n      'textContent': '?',\r\n      'className': 'bm-help',\r\n      'onclick': () => {\r\n        this.updateInnerHTML(this.outputStatusId, tooltip);\r\n      }\r\n    };\r\n\r\n    const help = this.#createElement('button', properties, additionalProperties); // Creates the <button> element\r\n    callback(this, help); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<input>` to the overlay.\r\n   * This `<input>` element will have properties shared between all `<input>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<input>` that are NOT shared between all overlay `<input>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLInputElement):void} [callback=()=>{}] - Additional JS modification to the `<input>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.13\r\n   * @example\r\n   * // Assume all <input> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addInput({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <input id=\"foo\" class=\"bar\">Foobar.</input>\r\n   * </body>\r\n   */\r\n  addInput(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <input> DOM properties\r\n\r\n    const input = this.#createElement('input', properties, additionalProperties); // Creates the <input> element\r\n    callback(this, input); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a file input to the overlay. This includes a container and a button.\r\n   * This input element will have properties shared between all file input elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the file input that are NOT shared between all overlay file input elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLDivElement, HTMLInputElement, HTMLButtonElement):void} [callback=()=>{}] - Additional JS modification to the file input.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.17\r\n   * @example\r\n   * // Assume all file input elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addInputFile({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <div>\r\n   *     <input type=\"file\" id=\"foo\" class=\"bar\" style=\"display: none\"></input>\r\n   *     <button>Foobar.</button>\r\n   *   </div>\r\n   * </body>\r\n   */\r\n  addInputFile(additionalProperties = {}, callback = () => {}) {\r\n    \r\n    const properties = {'type': 'file', 'style': 'display: none;'}; // Shared file input DOM properties\r\n    const text = additionalProperties['textContent'] ?? ''; // Retrieves the text content\r\n\r\n    delete additionalProperties['textContent']; // Deletes the text content before applying the additional properties to the file input\r\n\r\n    const container = this.#createElement('div'); // Container for file input\r\n    const input = this.#createElement('input', properties, additionalProperties); // Creates the file input\r\n    this.buildElement(); // Signifies that we are done adding children to the file input\r\n    const button = this.#createElement('button', {'textContent': text});\r\n    this.buildElement(); // Signifies that we are done adding children to the button\r\n    this.buildElement(); // Signifies that we are done adding children to the container\r\n\r\n    button.addEventListener('click', () => {\r\n      input.click(); // Clicks the file input\r\n    });\r\n\r\n    // Changes the button text content (and trims the file name)\r\n    input.addEventListener('change', () => {\r\n      button.style.maxWidth = `${button.offsetWidth}px`;\r\n      if (input.files.length > 0) {\r\n        button.textContent = input.files[0].name;\r\n      } else {\r\n        button.textContent = text;\r\n      }\r\n    });\r\n\r\n    callback(this, container, input, button); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Adds a `<textarea>` to the overlay.\r\n   * This `<textarea>` element will have properties shared between all `<textarea>` elements in the overlay.\r\n   * You can override the shared properties by using a callback.\r\n   * @param {Object.<string, any>} [additionalProperties={}] - The DOM properties of the `<textarea>` that are NOT shared between all overlay `<textarea>` elements. These should be camelCase.\r\n   * @param {function(Overlay, HTMLTextAreaElement):void} [callback=()=>{}] - Additional JS modification to the `<textarea>`.\r\n   * @returns {Overlay} Overlay class instance (this)\r\n   * @since 0.43.13\r\n   * @example\r\n   * // Assume all <textarea> elements have a shared class (e.g. {'className': 'bar'})\r\n   * overlay.addTextarea({'id': 'foo', 'textContent': 'Foobar.'}).buildOverlay(document.body);\r\n   * // Output:\r\n   * // (Assume <body> already exists in the webpage)\r\n   * <body>\r\n   *   <textarea id=\"foo\" class=\"bar\">Foobar.</textarea>\r\n   * </body>\r\n   */\r\n  addTextarea(additionalProperties = {}, callback = () => {}) {\r\n\r\n    const properties = {}; // Shared <textarea> DOM properties\r\n\r\n    const textarea = this.#createElement('textarea', properties, additionalProperties); // Creates the <textarea> element\r\n    callback(this, textarea); // Runs any script passed in through the callback\r\n    return this;\r\n  }\r\n\r\n  /** Updates the inner HTML of the element.\r\n   * The element is discovered by it's id.\r\n   * If the element is an <input>, it will modify the value attribute instead.\r\n   * @param {string} id - The ID of the element to change\r\n   * @param {string} html - The HTML/text to update with\r\n   * @param {boolean} [doSafe] - (Optional) Should `textContent` be used instead of `innerHTML` to avoid XSS? False by default\r\n   * @since 0.24.2\r\n   */\r\n  updateInnerHTML(id, html, doSafe=false) {\r\n\r\n    const element = document.getElementById(id.replace(/^#/, '')); // Retrieve the element from the 'id' (removed the '#')\r\n    \r\n    if (!element) {return;} // Kills itself if the element does not exist\r\n\r\n    // Input elements don't have innerHTML, so we modify the value attribute instead\r\n    if (element instanceof HTMLInputElement) {\r\n      element.value = html;\r\n      return;\r\n    } \r\n\r\n    if (doSafe) {\r\n      element.textContent = html; // Populate element with plain-text HTML/text\r\n    } else {\r\n      element.innerHTML = html; // Populate element with HTML/text\r\n    }\r\n  }\r\n\r\n  /** Handles dragging of the overlay.\r\n   * @param {string} moveMe - The ID of the element to be moved\r\n   * @param {string} iMoveThings - The ID of the element to be moved\r\n   * @since 0.8.2\r\n  */\r\n  handleDrag(moveMe, iMoveThings) {\r\n    let isDragging = false;\r\n    let offsetX, offsetY = 0;\r\n\r\n    // Retrieves the elements (allows either '#id' or 'id' to be passed in)\r\n    moveMe = document.querySelector(moveMe?.[0] == '#' ? moveMe : '#' + moveMe);\r\n    iMoveThings = document.querySelector(iMoveThings?.[0] == '#' ? iMoveThings : '#' + iMoveThings);\r\n\r\n    // What to do when one of the two elements are not found\r\n    if (!moveMe || !iMoveThings) {\r\n      this.handleDisplayError(`Can not drag! ${!moveMe ? 'moveMe' : ''} ${!moveMe && !iMoveThings ? 'and ' : ''}${!iMoveThings ? 'iMoveThings ' : ''}was not found!`);\r\n      return; // Kills itself\r\n    }\r\n\r\n    // What to do when the mouse is pressed down on the element that moves things\r\n    iMoveThings.addEventListener('mousedown', function(event) {\r\n      isDragging = true;\r\n      offsetX = event.clientX - moveMe.getBoundingClientRect().left;\r\n      offsetY = event.clientY - moveMe.getBoundingClientRect().top;\r\n      document.body.style.userSelect = 'none'; // Prevents text selection while dragging\r\n      iMoveThings.classList.add('dragging'); // Adds a class to indicate a dragging state\r\n    });\r\n\r\n    // What to do when the touch starts on the element that moves things\r\n    iMoveThings.addEventListener('touchstart', function(event) {\r\n      isDragging = true;\r\n      const touch = event?.touches?.[0];\r\n      if (!touch) {return;}\r\n      offsetX = touch.clientX - moveMe.getBoundingClientRect().left; // Distance between the left edge of the overlay, and the cursor\r\n      offsetY = touch.clientY - moveMe.getBoundingClientRect().top; // Distance between the top edge of the overlay, and the cursor\r\n      document.body.style.userSelect = 'none'; // Prevents text selection while dragging\r\n      iMoveThings.classList.add('dragging'); // Adds a class to indicate a dragging state\r\n    }, { passive: false }); // Prevents scrolling from being captured\r\n\r\n    // What to do when the mouse is moved while dragging\r\n    document.addEventListener('mousemove', function(event) {\r\n      if (isDragging) {\r\n        moveMe.style.left = (event.clientX - offsetX) + 'px'; // Binds the overlay to the left side of the screen, and sets it's position to the cursor\r\n        moveMe.style.top = (event.clientY - offsetY) + 'px'; // Binds the overlay to the top of the screen, and sets it's position to the cursor\r\n        moveMe.style.right = ''; // Destroys the right property to unbind the overlay from the right side of the screen\r\n      }\r\n    });\r\n\r\n    // What to do when the touch moves while dragging\r\n    document.addEventListener('touchmove', function(event) {\r\n      if (isDragging) {\r\n        const touch = event?.touches?.[0];\r\n        if (!touch) {return;}\r\n        moveMe.style.left = (touch.clientX - offsetX) + 'px';\r\n        moveMe.style.top = (touch.clientY - offsetY) + 'px';\r\n        event.preventDefault(); // prevent scrolling while dragging\r\n      }\r\n    }, { passive: false }); // Prevents scrolling from being captured\r\n\r\n    // What to do when the mouse is released\r\n    document.addEventListener('mouseup', function() {\r\n      isDragging = false;\r\n      document.body.style.userSelect = ''; // Restores text selection capability after dragging\r\n      iMoveThings.classList.remove('dragging'); // Removes the dragging class\r\n    });\r\n\r\n    // What to do when the touch ends\r\n    document.addEventListener('touchend', function() {\r\n      isDragging = false;\r\n      document.body.style.userSelect = ''; // Restores text selection capability after dragging\r\n      iMoveThings.classList.remove('dragging'); // Removes the dragging class\r\n    });\r\n\r\n    // What to do when the touch is cancelled\r\n    document.addEventListener('touchcancel', function() {\r\n      isDragging = false;\r\n      document.body.style.userSelect = ''; // Restores text selection capability after dragging\r\n      iMoveThings.classList.remove('dragging'); // Removes the dragging class\r\n    });\r\n  }\r\n\r\n  /** Handles error display.\r\n   * This will output plain text into the output Status box.\r\n   * Additionally, this will output an error to the console.\r\n   * @param {string} text - The error text to display.\r\n   * @since 0.41.6\r\n   */\r\n  handleDisplayError(text) {\r\n    const consoleError = console.error; // Idk anymore...\r\n    consoleError(`${this.name}: ${text}`); // Outputs something like \"ScriptName: text\" as an error to the console\r\n    this.updateInnerHTML(this.outputStatusId, 'Error: ' + text, true);\r\n  }\r\n}","/** This class contains all MutationObservers used (which is 1 probably).\r\n * This is not an object, but rather a \"collection\" of functions (in a class).\r\n * @since 0.43.2\r\n */\r\nexport default class Observers {\r\n\r\n  /** The constructor for the observer class\r\n   * @since 0.43.2\r\n   */\r\n  constructor() {\r\n    this.observerBody = null;\r\n    this.observerBodyTarget = null;\r\n    this.targetDisplayCoords = '#bm-display-coords';\r\n  }\r\n\r\n  /** Creates the MutationObserver for document.body\r\n   * @param {HTMLElement} target - Targeted element to watch\r\n   * @returns {Observers} this (Observers class)\r\n   * @since 0.43.2\r\n   */\r\n  createObserverBody(target) {\r\n\r\n    this.observerBodyTarget = target;\r\n\r\n    this.observerBody = new MutationObserver((mutations) => {\r\n      for (const mutation of mutations) {\r\n        for (const node of mutation.addedNodes) {\r\n\r\n          if (!(node instanceof HTMLElement)) {continue;} // Does not track non-HTMLElements\r\n          \r\n          if (node.matches?.(this.targetDisplayCoords)) {\r\n\r\n          }\r\n        }\r\n      }\r\n    })\r\n\r\n    return this;\r\n  }\r\n\r\n  /** Retrieves the MutationObserver that watches document.body\r\n   * @returns {MutationObserver}\r\n   * @since 0.43.2\r\n   */\r\n  getObserverBody() {\r\n    return this.observerBody;\r\n  }\r\n\r\n  /** Observe a MutationObserver\r\n   * @param {MutationObserver} observer - The MutationObserver\r\n   * @param {boolean} watchChildList - (Optional) Should childList be watched? False by default\r\n   * @param {boolean} watchSubtree - (Optional) Should childList be watched? False by default\r\n   * @since 0.43.2\r\n   */\r\n  observe(observer, watchChildList=false, watchSubtree=false) {\r\n    observer.observe(this.observerBodyTarget, {\r\n      childList: watchChildList,\r\n      subtree: watchSubtree\r\n    });\r\n  }\r\n}","/** Contains miscellaneous helper functions.\r\n * @since 0.44.2\r\n */\r\nexport default class Utils {\r\n\r\n  /** Sanitizes HTML to display as plain-text.\r\n   * This prevents some Cross Site Scripting (XSS).\r\n   * This is handy when you are displaying user-made data, and you *must* use innerHTML.\r\n   * @param {string} text - The text to sanitize\r\n   * @returns {string} HTML escaped string\r\n   * @since 0.44.2\r\n   * @example\r\n   * const paragraph = document.createElement('p');\r\n   * paragraph.innerHTML = escapeHTML('<u>Foobar.</u>');\r\n   * // Output:\r\n   * // (Does not include the paragraph element)\r\n   * // (Output is not HTML formatted)\r\n   * <p>\r\n   *   \"<u>Foobar.</u>\"\r\n   * </p>\r\n   */\r\n  static escapeHTML(text) {\r\n    const div = document.createElement('div'); // Creates a div\r\n    div.textContent = text; // Puts the text in a PLAIN-TEXT property\r\n    return div.innerHTML; // Returns the HTML property of the div\r\n  }\r\n}","import Overlay from './overlay.js';\r\nimport Observers from './observers.js';\r\nimport CoordsHandler from './coordsHandler.js';\r\nimport ApiHandler from './apiHandler.js';\r\n\r\nconst name = GM_info.script.name.toString();\r\nconst version = GM_info.script.version.toString();\r\n\r\n/** Injects code into the client\r\n * This code will execute outside of TamperMonkey's sandbox\r\n * @param {*} fn - The code to execute\r\n * @since 0.11.15\r\n */\r\nfunction inject(fn) {\r\n    const script = document.createElement('script');\r\n    script.textContent = `(${fn})();`;\r\n    document.documentElement.appendChild(script);\r\n    script.remove();\r\n}\r\n\r\n/** What code to execute instantly in the client.\r\n * This code will execute outside of TamperMonkey's sandbox\r\n * @since 0.11.15\r\n */\r\ninject(() => {\r\n  \r\n  // Spys on \"spontaneous\" fetch requests made by the client\r\n  const originalFetch = window.fetch; // Saves a copy of the original fetch\r\n\r\n  // Overrides fetch\r\n  window.fetch = async function(...args) {\r\n\r\n    const response = await originalFetch.apply(this, args); // Sends a fetch\r\n    const cloned = response.clone(); // Makes a copy of the response\r\n\r\n    // Check Content-Type to only process JSON\r\n    const contentType = cloned.headers.get('content-type') || '';\r\n    if (contentType.includes('application/json')) {\r\n\r\n      // Retrieves the endpoint name. Unknown endpoint = \"ignore\"\r\n      let endpointName = ((args[0] instanceof Request) ? args[0]?.url : args[0]) || 'ignore';\r\n      //endpointName = endpointName.split('/').filter(Boolean).pop() || 'ignore';\r\n\r\n      console.log(`Sending JSON message about endpoint \"${endpointName}\"`);\r\n\r\n      // Sends a message about the endpoint it spied on\r\n      cloned.json()\r\n        .then(jsonData => {\r\n          window.postMessage({\r\n            source: 'blue-marble',\r\n            endpoint: endpointName,\r\n            jsonData: jsonData\r\n          }, '*');\r\n        })\r\n        .catch(err => {\r\n          console.error('BM - Failed to parse JSON:', err);\r\n        });\r\n    }\r\n\r\n    return response; // Returns the original response\r\n  };\r\n});\r\n\r\n// Imports the CSS file from dist folder on github\r\nconst cssOverlay = GM_getResourceText(\"CSS-BM-File\");\r\nGM_addStyle(cssOverlay);\r\n\r\n// Imports the Roboto Mono font family\r\nvar stylesheetLink = document.createElement('link');\r\nstylesheetLink.href = 'https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap';\r\nstylesheetLink.rel = 'preload';\r\nstylesheetLink.as = 'style';\r\nstylesheetLink.onload = function () {\r\n  this.onload = null;\r\n  this.rel = 'stylesheet';\r\n};\r\ndocument.head.appendChild(stylesheetLink);\r\n\r\nconst observers = new Observers(); // Constructs a new Observers object\r\nconst overlay = new Overlay(name, version); // Constructs a new Overlay object\r\nconst coordsHandler = new CoordsHandler(); // Constructs a new CoordsHandler object\r\nconst apiHandler = new ApiHandler(coordsHandler); // Constructs a new ApiHandler object\r\n\r\noverlay.setApiHandler(apiHandler); // Sets the API handler\r\n\r\n// Deploys the overlay to the page\r\n// Parent/child relationships in the DOM structure below are indicated by indentation\r\noverlay.addDiv({'id': 'bm-overlay', 'style': 'top: 10px; right: 75px;'})\r\n  .addDiv({'id': 'bm-contain-header'})\r\n    .addDiv({'id': 'bm-bar-drag'}).buildElement()\r\n    .addImg({'alt': 'Blue Marble Icon', 'src': 'https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/src/assets/Favicon.png'}).buildElement()\r\n    .addHeader(1, {'textContent': name}).buildElement()\r\n  .buildElement()\r\n\r\n  .addHr().buildElement()\r\n\r\n  .addDiv({'id': 'bm-contain-userinfo'})\r\n    .addP({'id': 'bm-user-name', 'textContent': 'Username:'}).buildElement()\r\n    .addP({'id': 'bm-user-droplets', 'textContent': 'Droplets:'}).buildElement()\r\n    .addP({'id': 'bm-user-nextlevel', 'textContent': 'Next level in...'}).buildElement()\r\n  .buildElement()\r\n\r\n  .addHr().buildElement()\r\n\r\n  .addDiv({'id': 'bm-contain-automation'})\r\n    .addCheckbox({'id': 'bm-input-stealth', 'textContent': 'Stealth', 'checked': true}).buildElement()\r\n    .addButtonHelp({'title': 'Waits for the website to make requests, instead of sending requests.'}).buildElement()\r\n    .addBr().buildElement()\r\n    .addCheckbox({'id': 'bm-input-possessed', 'textContent': 'Possessed', 'checked': true}).buildElement()\r\n    .addButtonHelp({'title': 'Controls the website as if it were possessed.'}).buildElement()\r\n    .addBr().buildElement()\r\n    .addDiv({'id': 'bm-contain-coords'})\r\n      .addButton({'id': 'bm-button-coords', 'className': 'bm-help', 'style': 'margin-top: 0;', 'innerHTML': '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 4 6\"><circle cx=\"2\" cy=\"2\" r=\"2\"></circle><path d=\"M2 6 L3.7 3 L0.3 3 Z\"></path><circle cx=\"2\" cy=\"2\" r=\"0.7\" fill=\"white\"></circle></svg></svg>'},\r\n        (instance, button) => {\r\n          button.onclick = () => {\r\n            const coords = instance.apiHandler?.coordsTilePixel; // Retrieves the coords from the API handler\r\n            if (!coords?.[0]) {\r\n              instance.handleDisplayError('Coordinates are malformed! Did you try clicking on the canvas first?');\r\n              return;\r\n            }\r\n            instance.updateInnerHTML('bm-input-tx', coords?.[0] || '');\r\n            instance.updateInnerHTML('bm-input-ty', coords?.[1] || '');\r\n            instance.updateInnerHTML('bm-input-px', coords?.[2] || '');\r\n            instance.updateInnerHTML('bm-input-py', coords?.[3] || '');\r\n          }\r\n        }\r\n      ).buildElement()\r\n      .addInput({'type': 'number', 'id': 'bm-input-tx', 'placeholder': 'Tl X', 'min': 0, 'max': 2047, 'step': 1}).buildElement()\r\n      .addInput({'type': 'number', 'id': 'bm-input-ty', 'placeholder': 'Tl Y', 'min': 0, 'max': 2047, 'step': 1}).buildElement()\r\n      .addInput({'type': 'number', 'id': 'bm-input-px', 'placeholder': 'Px X', 'min': 0, 'max': 2047, 'step': 1}).buildElement()\r\n      .addInput({'type': 'number', 'id': 'bm-input-py', 'placeholder': 'Px Y', 'min': 0, 'max': 2047, 'step': 1}).buildElement()\r\n    .buildElement()\r\n    .addInputFile({'id': 'bm-input-file-template', 'textContent': 'Upload Template'}).buildElement()\r\n    .addDiv({'id': 'bm-contain-buttons'})\r\n      .addButton({'id': 'bm-button-enable', 'textContent': 'Enable'}).buildElement()\r\n      .addButton({'id': 'bm-button-disable', 'textContent': 'Disable'}).buildElement()\r\n    .buildElement()\r\n    .addTextarea({'id': overlay.outputStatusId, 'placeholder': `Status: Sleeping...\\nVersion: ${version}`, 'readOnly': true}).buildElement()\r\n  .buildElement()\r\n.buildOverlay(document.body);\r\n\r\noverlay.handleDrag('#bm-overlay', '#bm-bar-drag'); // Creates dragging capability on the drag bar for dragging the overlay\r\n\r\napiHandler.spontaneousResponseListener(overlay); // Reads spontaneous fetch responces\r\n\r\nconsole.log(`${name} (${version}) userscript has loaded!`);","/** Handles translation of coordinate systems.\r\n * @since 0.42.4\r\n */\r\nexport default class CoordsHandler {\r\n\r\n  /** Converts the server tile-pixel coordinate system to the displayed tile-pixel coordinate system.\r\n   * @param {string[]} tile - The tile to convert (as an array like [\"12\", \"124\"])\r\n   * @param {string[]} pixel - The pixel to convert (as an array like [\"12\", \"124\"])\r\n   * @returns {number[]} [tile, pixel]\r\n   * @since 0.42.4\r\n   * @example\r\n   * console.log(serverTPtoDisplayTP(['12', '123'], ['34', '567'])); // [34, 3567]\r\n   */\r\n  serverTPtoDisplayTP(tile, pixel) {\r\n    return [((parseInt(tile[0]) % 4) * 1000) + parseInt(pixel[0]), ((parseInt(tile[1]) % 4) * 1000) + parseInt(pixel[1])];\r\n  }\r\n}","/** ApiHandler class for handling API requests, responses, and interactions.\r\n * Note: Fetch spying is done in main.js, not here.\r\n * @since 0.11.1\r\n */\r\n\r\nimport Utils from \"./utils\";\r\n\r\nexport default class ApiHandler {\r\n\r\n  /** Constructor for ApiHandler class\r\n   * @param {CoordsHandler} coordsHandler - The CoordsHandler instance\r\n   * @since 0.11.34\r\n   */\r\n  constructor(coordsHandler) {\r\n    this.coordsHandler = coordsHandler;\r\n    this.disableAll = false; // Should the entire userscript be disabled?\r\n    this.coordsTilePixel = []; // Contains the last detected tile/pixel coordinate pair requested\r\n  }\r\n\r\n  /** Determines if the spontaneously recieved response is something we want.\r\n   * Otherwise, we can ignore it.\r\n   * Note: Due to aggressive compression, make your calls like `data['jsonData']['name']` instead of `data.jsonData.name`\r\n   * \r\n   * @param {Overlay} overlay - The Overlay class instance\r\n   * @since 0.11.1\r\n  */\r\n  spontaneousResponseListener(overlay) {\r\n\r\n    // Triggers whenever a message is sent\r\n    window.addEventListener('message', (event) => {\r\n\r\n      const data = event.data; // The data of the message\r\n      const dataJSON = data['jsonData']; // The JSON response, if any\r\n\r\n      // Kills itself if the message was not intended for Blue Marble\r\n      if (!(data && data['source'] === 'blue-marble')) {return;}\r\n\r\n      // Trims endpoint to the second to last non-number, non-null directoy.\r\n      // E.g. \"wplace.live/api/pixel/0/0?payload\" -> \"pixel\"\r\n      const endpointText = data['endpoint'].split('?')[0].split('/').filter(s => s && isNaN(Number(s))).pop();\r\n\r\n      console.log(`Recieved message about \"${endpointText}\"`);\r\n\r\n      // Each case is something that Blue Marble can use from the fetch.\r\n      // For instance, if the fetch was for \"me\", we can update the overlay stats\r\n      switch (endpointText) {\r\n\r\n        case 'me': // Request to retrieve user data\r\n\r\n          // If the game can not retrieve the userdata...\r\n          if (dataJSON['status'] && dataJSON['status']?.toString()[0] != '2') {\r\n            // The server is probably down (NOT a 2xx status)\r\n            \r\n            overlay.handleDisplayError(`The game is down!\\nCould not fetch userdata.`);\r\n            return; // Kills itself before attempting to display null userdata\r\n          }\r\n\r\n          const nextLevelPixels = Math.ceil(Math.pow(Math.floor(dataJSON['level']) * Math.pow(30, 0.65), (1/0.65)) - dataJSON['pixelsPainted']); // Calculates pixels to the next level\r\n          \r\n          const clog = console.log;\r\n          clog(dataJSON);\r\n          clog(dataJSON?.droplets);\r\n\r\n          overlay.updateInnerHTML('bm-user-name', `Username: <b>${Utils.escapeHTML(dataJSON['name'])}</b>`); // Updates the text content of the username field\r\n          overlay.updateInnerHTML('bm-user-droplets', `Droplets: <b>${new Intl.NumberFormat().format(dataJSON['droplets'])}</b>`); // Updates the text content of the droplets field\r\n          overlay.updateInnerHTML('bm-user-nextlevel', `Next level in <b>${new Intl.NumberFormat().format(nextLevelPixels)}</b> pixel${nextLevelPixels == 1 ? '' : 's'}`); // Updates the text content of the next level field\r\n          break;\r\n\r\n        case 'pixel': // Request to retrieve pixel data\r\n          const coordsTile = data['endpoint'].split('?')[0].split('/').filter(s => s && !isNaN(Number(s))); // Retrieves the tile coords as [x, y]\r\n          const payloadExtractor = new URLSearchParams(data['endpoint'].split('?')[1]); // Declares a new payload deconstructor and passes in the fetch request payload\r\n          const coordsPixel = [payloadExtractor.get('x'), payloadExtractor.get('y')]; // Retrieves the deconstructed pixel coords from the payload\r\n          this.coordsTilePixel = [...coordsTile, ...coordsPixel]; // Combines the two arrays such that [x, y, x, y]\r\n          const displayTP = this.coordsHandler.serverTPtoDisplayTP(coordsTile, coordsPixel);\r\n          \r\n          const spanElements = document.querySelectorAll('span'); // Retrieves all span elements\r\n\r\n          // For every span element, find the one we want (pixel numbers when canvas clicked)\r\n          for (const element of spanElements) {\r\n            if (element.textContent.trim().includes(`${displayTP[0]}, ${displayTP[1]}`)) {\r\n\r\n              let displayCoords = document.querySelector('#bm-display-coords'); // Find the additional pixel coords span\r\n\r\n              const text = `(Tl X: ${coordsTile[0]}, Tl Y: ${coordsTile[1]}, Px X: ${coordsPixel[0]}, Px Y: ${coordsPixel[1]})`;\r\n              \r\n              // If we could not find the addition coord span, we make it then update the textContent with the new coords\r\n              if (!displayCoords) {\r\n                displayCoords = document.createElement('span');\r\n                displayCoords.id = 'bm-display-coords';\r\n                displayCoords.textContent = text;\r\n                displayCoords.style = 'margin-left: calc(var(--spacing)*3); font-size: small;';\r\n                element.parentNode.parentNode.parentNode.insertAdjacentElement('afterend', displayCoords);\r\n              } else {\r\n                displayCoords.textContent = text;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n\r\n        case 'robots': // Request to retrieve what script types are allowed\r\n          this.disableAll = dataJSON['userscript']?.toString().toLowerCase() == 'false'; // Disables Blue Marble if site owner wants userscripts disabled\r\n          break;\r\n\r\n      }\r\n    });\r\n  }\r\n}"],"mappings":"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","ignoreList":[]}